function message(msg, type, title) {
    let icon = 'error';
    if (type === 'success') {
        icon = 'success';
    }
    Swal.fire({
        title: title,
        html: msg,
        icon: icon,
        timer: type === 'success' ? 2000 : 6000,
        confirmButtonText: 'Fechar',
        showCancelButton: false,
        confirmButtonColor: "#5156be",
        cancelButtonColor: "#fd625e"
    }).then((result) => {
        /* Read more about handling dismissals below */
        if (result.dismiss === Swal.DismissReason.timer) {
            console.log('I was closed by the timer')
        }
    });
}
(function ($) {
    'use strict';
    jQuery(document).ready(function () {
        $("#user-phone").mask("999.999.999-99");
        $("#password-addon").click(function () {
            if ($("#user_password").attr("type") == "password") {
                $("#user_password").attr("type", "text");
                $(this).find("i").removeClass().addClass("fa fa-eye-slash");
                $(this).attr("title", "Clique aqui para ocultar a senha");
            } else {
                // restore
                $("#user_password").attr("type", "password");
                $(this).find("i").removeClass().addClass("fa fa-eye");
                $(this).attr("title", "Clique aqui para mostrar a senha");
            }
        });
        function closeDialog() {
            $(".alert .close").click(function () {
                console.log(".");
                $(".alert").remove();
            });
        }
        $('input[name="loginby"]').change(function () {
            $("#label-login").html($(this).val());
            $("#user-phone").val('');
            if ($(this).val() == "CPF") {
                $("#user-phone").mask("999.999.999-99");
                $("#user-phone").attr("placeholder", "000.000.000-00");
            } else {
                $("#user-phone").mask("99.999.999/9999-99");
                $("#user-phone").attr("placeholder", "00.000.000/0000-00");
            }
        });
        $("#login-form").validate({
            errorElement: 'span',
            errorClass: 'error',
            focusInvalid: true,
            ignore: ":hidden",
            rules: {},
            errorPlacement: function (error, element) {
                var icon = $(element).parent('.input-with-icon').children('i');
                var parent = $(element).parent('.input-with-icon');
                icon.removeClass('fa fa-check').addClass('fa fa-exclamation');
                parent.removeClass('success-control').addClass('error-control');

            },
            highlight: function (element) {
                var parent = $(element).parent();
                parent.removeClass('success-control').addClass('error-control');
            },
            success: function (label, element) {
                var icon = $(element).parent('.input-with-icon').children('i');
                var parent = $(element).parent('.input-with-icon');
                icon.removeClass("fa fa-exclamation").addClass('fa fa-check');
                parent.removeClass('error-control').addClass('success-control');
            },
            invalidHandler: function () {
                $('#login-form button[type=submit], input[type=submit]').attr('disabled', false);
                // $("#loading").addClass("hidden");
                $('#login-form button[type=submit], input[type=submit]').html('Login');
            },
            submitHandler: function (form) {
                $("#login-form #result").html('');
                if (!$("#user-phone").val().length) {
                    message("Você esqueceu de digitar o seu CPF/CNPJ", "danger", "Erro ao logar");
                    return;
                }
                if (!$("#user_password").val().length) {
                    message("Você esqueceu de digitar a sua senha", "danger", "Erro ao logar");
                    return;
                }
                $('#login-form button[type=submit], input[type=submit]').attr('disabled', true);
                $('#login-form button[type=submit], input[type=submit]').html('<div class="preloader preloader-splash"><div class="preloader-spinner preloader-container"><div class="preloader-spinner preloader-fill"><div class="preloader-clipper left"><div class="preloader-circle"></div></div><div class="preloader-gap-patch"><div class="preloader-circle"></div></div><div class="preloader-clipper right"><div class="preloader-circle"></div></div></div></div></div>');
                var data = new FormData($(form)[0]);
                $.ajax({
                    url: "login/login",
                    type: "POST",
                    data: data,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        $.each($(".input-with-icon"), function (k, v) {
                            if ($(v).hasClass("success-control")) {
                                $(v).removeClass('success-control');
                                $(v).find('i').removeClass();
                            }
                        });
                        if (data.error) {
                            message(data.message, 'danger', "Erro ao logar");
                        } else {
                            $("#login-form").trigger('reset');
                            window.location.href = data.redirect;
                        }
                    },
                    complete: function () {
                        $('#login-form button[type=submit], input[type=submit]').attr('disabled', false);
                        $("#login-form #loading").addClass("hidden");
                        $('#login-form button[type=submit], input[type=submit]').html('Login');
                    }
                });
                return false;
            }
        })
    });

})(jQuery);