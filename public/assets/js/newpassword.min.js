function message(msg, type, title) {
    let icon = 'error';
    if (type === 'success') {
        icon = 'success';
    }
    Swal.fire({
        title: title,
        html: msg,
        icon: icon,
        timer: type === 'success' ? 2000 : 6000,
        confirmButtonText: 'Fechar',
        showCancelButton: false,
        confirmButtonColor: "#5156be",
        cancelButtonColor: "#fd625e"
    }).then((result) => {
        /* Read more about handling dismissals below */
        if (result.dismiss === Swal.DismissReason.timer) {
            console.log('I was closed by the timer')
        }
    });
}
$(document).ready(function () {
    $("#newpassword-form").validate({
        errorElement: 'span',
        errorClass: 'error',
        focusInvalid: true,
        ignore: ":hidden",
        rules: {},
        errorPlacement: function (error, element) {
            var icon = $(element).parent('.input-with-icon').children('i');
            var parent = $(element).parent('.input-with-icon');
            icon.removeClass('fa fa-check').addClass('fa fa-exclamation');
            parent.removeClass('success-control').addClass('error-control');

        },
        highlight: function (element) {
            var parent = $(element).parent();
            parent.removeClass('success-control').addClass('error-control');
        },
        success: function (label, element) {
            var icon = $(element).parent('.input-with-icon').children('i');
            var parent = $(element).parent('.input-with-icon');
            icon.removeClass("fa fa-exclamation").addClass('fa fa-check');
            parent.removeClass('error-control').addClass('success-control');
        },
        invalidHandler: function () {
            $('#newpassword-form button[type=submit], input[type=submit]').attr('disabled', false);
            // $("#loading").addClass("hidden");
            $('#newpassword-form button[type=submit], input[type=submit]').html('Login');
        },
        submitHandler: function (form) {
            $("#newpassword-form #result").html('');
            $('#newpassword-form button[type=submit], input[type=submit]').attr('disabled', true);


            $('#newpassword-form button[type=submit], input[type=submit]').html('<div class="preloader preloader-splash"><div class="preloader-spinner preloader-container"><div class="preloader-spinner preloader-fill"><div class="preloader-clipper left"><div class="preloader-circle"></div></div><div class="preloader-gap-patch"><div class="preloader-circle"></div></div><div class="preloader-clipper right"><div class="preloader-circle"></div></div></div></div></div>')
            //$("#newpassword-form #loading").removeClass("hidden");
            data = new FormData($(form)[0]);
            $.ajax({
                url: "login/setpassword",
                type: "POST",
                data: data,
                processData: false,
                contentType: false,
                success: function (data) {
                    if (data.error) {
                        message(data.msg, 'danger', "Erro ao Redefinir Senha");
                    } else {
                        $("#newpassword-form").trigger('reset');
                        message(data.msg, 'success', "Senha Redefinida");
                        setTimeout(function () {
                            window.location.href = "login";
                        }, 3000)
                        // window.location.href = data.redirect;
                        //   $('#newpassword-form button[type=submit], input[type=submit]').addClass('hidden');

                    }
                },
                complete: function () {
                    $('#newpassword-form button[type=submit], input[type=submit]').attr('disabled', false);
                    $("#newpassword-form #loading").addClass("hidden");
                    $('#newpassword-form button[type=submit], input[type=submit]').html('Login');
                }
            });
            return false;
        }
    })
});